<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/core-field/core-field.html">
<link rel="import" href="../bower_components/core-media-query/core-media-query.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../elements/google-card.html">

<polymer-element name="google-search" attributes="q">
	<template>
		<style shim-shadowdom>
			:host {
				font-family: 'RobotoDraft', sans-serif;
			}

			.core-header {
		      height: 120px;
		      line-height: 60px;
		      font-size: 18px;
		      padding: 0 10px;
		      background-image: url("../img/search-bkg.png");
		      background-size: 100%;
		      color: #FFF;
		      transition: height 0.2s;
		    }

		    .core-header.tall {
		      height: 180px;
		    }

		    .content {
		      height: 2000px;
		      background: linear-gradient(rgb(214, 227, 231), lightblue);
		    }

		    core-field {
		      border-radius: 4px;
		      border: 0px;
		      height: 40px;
		      background-color: white;
		    }

		    .searchResults {
		    	margin-top: 50px;
		    }

		    .top-bar {
		    	right: 0px;
				line-height: 40px;
				font-weight: 300;
		    }
		</style>
		<core-ajax
			auto
		    url="../backend.php"
		    params='{"q":"{{q}}"}'
		    handleAs="json"
		    on-core-response="{{handleResponse}}"
		    id="coreAjax"></core-ajax>

		<core-toolbar class="core-header">
		      <img src="../img/google.png" on-click="{{goBack}}" style="margin-top: 5px; margin-left: {{marginLeft}}px;" hero-id="googleLogo" hero width="80px" height="25px">
		      <core-field flex>
			  	<input flex style="margin-left: 10px;" type="text" id="searchInput" value="{{q}}" on-change="{{search}}" hero-id="searchInput" hero>
			  	<core-icon icon="search"></core-icon>
			  </core-field>
		      <core-media-query query="max-width: 770px" queryMatches="{{phoneScreen}}"></core-media-query>
		      <template if="{{!phoneScreen}}">
			  <paper-icon-button icon="settings"></paper-icon-button>
			  <paper-icon-button icon="apps"></paper-icon-button>
			  <div class="top-bar">lespes29@gmail.com</div>
		      <paper-icon-button icon="arrow-drop-down"></paper-icon-button>
		      </template>

		      <div class="bottom fit" style="background-color: #385762;" horizontal layout>
		        <paper-tabs selected="0" scrollable flex style="line-height: 0px; margin-left: {{marginLeft}}px; max-width: 800px;">
		          <paper-tab>WEB</paper-tab>
		          <paper-tab>IMAGES</paper-tab>
		          <paper-tab>VIDEOS</paper-tab>
		          <paper-tab>MAPS</paper-tab> 
		          <paper-tab>MORE <core-icon icon="arrow-drop-down"></core-icon></paper-tab> 
		          <paper-tab>SEARCH TOOLS</paper-tab> 
		        </paper-tabs>
		        <template if="{{!phoneScreen}}">
		        	<div style="margin-bottom: 0; margin-top: 0; margin: auto; line-height: 0px;">4,043,537 results</div>
		    	</template>
		      </div>
		    </core-toolbar>
		    </div>
		    <div horizontal layout class="content">
		    	<div vertical layout class="searchResults" style="margin-left: {{marginLeft}}px; margin-right: {{marginLeft}}px;" flex>
		    		<template repeat="{{values in response}}" >
		    		<google-card link="{{values.site}}">
		    		<h1>{{values.lienTitre}}</h1>
		    		<h2>{{values.site}}</h2>
		    		<p>{{values.description}}</p>
		    		</google-card>
		    		</template>
		    	</div>
		   	</div>
	</template>
	<script>
		Polymer({
			response: null,
			marginLeft: 65,
			ready: function(){
				this.addEventListener('core-media-change', function(e) {
					this.marginLeft = (this.phoneScreen) ? 10 : 65
				})
			},
			goBack: function(e,detail,sender){
				this.fire("goBack",this.$.searchInput.value);
			},
			handleResponse: function(e){
				this.response = e.detail.response;
				console.dir(this.response);
			},
			search: function(e,detail,sender){
				this.fire("search",this.$.searchInput.value)
			}
		})
	</script>
</polymer-element>